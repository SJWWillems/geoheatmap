---
title: "Introduction to geoheatmap"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to geoheatmap}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


We took inspiration from the aesthetically made graphs in [statebin](https://github.com/hrbrmstr/statebins), and extended on its functionality by allowing for user-defined grids, which means that the cartogram heatmaps can now represent territories outside the US. Though any well-defined grid will technically work, grids from  [geofacet](/https://github.com/hafen/geofacet) are an excellent starting point.


## Installation and Setup

```{r eval=FALSE}
install.packages("geoheatmap")
# or from github:
# remotes::install_github()? if it's available
```

```{r setup}
#library(geoheatmap)
library(tidyverse)
library(geofacet)
library(viridisLite)
library(plotly)
```

## Usage

The data used for all examples is available in the geoheatmap package under the name `internet`.

```{r}
head(internet)
```


```{r, message= FALSE}
internet_2015 <- subset(internet, year == 2015)
geoheatmap(facet_data= internet_2015, grid_data= europe_countries_grid1,
           facet_col = "country", value_col = "users",
           low = "lightblue", high = "blue4")

```

```{r, message= FALSE}
internet_2015$users_per= ifelse(internet_2015$users > 75, "Above 75", "75 or Below")

geoheatmap(facet_data= internet_2015, grid_data= europe_countries_grid1,
           facet_col = "country", value_col = "users_per",
           name= "Internet users: divergent",
           ggplot2_scale_function = scale_fill_manual, # use gradient_2 instead
           values = c("Above 75" = plasma(2)[1], "75 or Below" = viridis(3)[3] ),
           round = TRUE)

```
You can use `round= TRUE` to give a rounded look to the tiles.

```{r, message= FALSE}
internet_2015$users_bin= cut(internet_2015$users, breaks = c(-Inf, 25, 50, Inf), labels = c("0-25", "26-50", "51 and up"))

geoheatmap(facet_data= internet_2015, grid_data= africa_countries_grid1,
           facet_col = "country", value_col = "users_bin",
           name= "Internet users: binned",
           ggplot2_scale_function = scale_fill_ordinal)

```

```{r, message= FALSE}
geoheatmap(facet_data= internet_2015, grid_data= africa_countries_grid1,
           facet_col = "country", value_col = "users_bin",
           name= "Internet users: binned",
           ggplot2_scale_function = scale_fill_manual,
           values= c("#450457", "#D23C74", "#F8E577"))
```
### Options

Sometimes, grids have local as well as anglophone location names, with the default being set to the latter. If you would like to use the regional version (e.g. because your data frame operates with native names), you can pass it in as an additional argument using `merge_col`.

```{r}
de_states_grid1
```


```{r}
# Dummy data frame with German states and number of football teams
football_teams= data.frame(
  state = c(
    "Baden-Württemberg", "Bayern", "Berlin", "Brandenburg",
    "Bremen", "Hamburg", "Hessen", "Mecklenburg-Vorpommern",
    "Niedersachsen", "Nordrhein-Westfalen", "Rheinland-Pfalz",
    "Saarland", "Sachsen", "Sachsen-Anhalt", "Schleswig-Holstein",
    "Thüringen"
  ),
  teams = c(18, 22, 8, 6, 4, 5, 14, 3, 12, 28, 10, 3, 9, 5, 7, 4)
)

geoheatmap(facet_data= football_teams,
        grid_data= de_states_grid1,
        facet_col = "state",value_col = "teams",merge_col = "name_de",
        name= "No. of teams",
        low = "lightblue", high = "blue4",
        round = TRUE)

```

### Interactive plots

```{r}
geoheatmap(facet_data= football_teams,
        grid_data= de_states_grid1,
        facet_col = "state",value_col = "teams",merge_col = "name_de",
        name= "No. of teams",
        low = "lightblue", high = "blue4",
        hover = TRUE)
```

Note that the custom geoms created in the `statebins` package are not yet implemented in `plotly`, which means that calling `round = TRUE` in conjunction with `hover = TRUE` does not (yet) work.

```{r}
geoheatmap(facet_data= football_teams,
        grid_data= de_states_grid1,
        facet_col = "state",value_col = "teams",merge_col = "name_de",
        name= "No. of teams",
        low = "lightblue", high = "blue4",
        round = TRUE,
        hover = TRUE)
```

### List available grids

To get the list of names of available grids in the geofacet package so far, call:

```{r}
geofacet::get_grid_names()
```

This list is constantly being updated as authors of the geofacet made uploading your own grids possible. You can learn how to submit your own by following the steps in next section.

### Creating your own grid

For detailed instructions on creating a custom grid, see the "Creating your own grid" section in the `geofacet` vignette. You can find it at: https://cran.r-project.org/web/packages/geofacet/vignettes/geofacet.html

